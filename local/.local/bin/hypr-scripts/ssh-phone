#!/bin/bash

# Define your Termux user (Replace this with your own Termux username)
TERMUX_USER="u0_a231"
TERMUX_PORT="8022"

# Find the local subnet automatically
SUBNET=$(ip -o -f inet addr show | awk '/scope global/ {print $4}' | head -n 1)

# Scan for the phone (devices with port 8022 open)
# We use timeout just in case nmap hangs
PHONE_IP=$(nmap -p $TERMUX_PORT --open "$SUBNET" -oG - | awk '/Up$/{print $2}' | head -n 1)

if [ -z "$PHONE_IP" ]; then
    # Print error to stdout so it shows up in the TUI window before closing
    echo "Error: Phone not found on network."
    echo "Make sure Termux is running and 'sshd' is active."
    read -p "Press Enter to close..."
    exit 1
fi

# Connect
echo "Found phone at: $PHONE_IP"
echo "Connecting..."

# We use 'exec' so this script process is replaced by the ssh process
exec ssh -p $TERMUX_PORT "$TERMUX_USER@$PHONE_IP"
